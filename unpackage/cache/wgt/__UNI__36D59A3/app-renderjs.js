var __renderjsModules={};
__renderjsModules["06bd5139"]=(()=>{var v=Object.defineProperty;var X=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames,j=Object.getOwnPropertySymbols;var F=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var D=(n,e,t)=>e in n?v(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,H=(n,e)=>{for(var t in e||(e={}))F.call(e,t)&&D(n,t,e[t]);if(j)for(var t of j(e))G.call(e,t)&&D(n,t,e[t]);return n};var Q=(n,e)=>{for(var t in e)v(n,t,{get:e[t],enumerable:!0})},Z=(n,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of z(e))!F.call(n,a)&&a!==t&&v(n,a,{get:()=>e[a],enumerable:!(o=X(e,a))||o.enumerable});return n};var ee=n=>Z(v({},"__esModule",{value:!0}),n);var E=(n,e,t)=>new Promise((o,a)=>{var l=r=>{try{i(t.next(r))}catch(c){a(c)}},s=r=>{try{i(t.throw(r))}catch(c){a(c)}},i=r=>r.done?o(r.value):Promise.resolve(r.value).then(l,s);i((t=t.apply(n,e)).next())});var de={};Q(de,{default:()=>le});function P(n,e){return E(this,null,function*(){let t=n.getReader(),o;for(;!(o=yield t.read()).done;)e(o.value)})}function B(n){let e,t,o,a=!1;return function(s){e===void 0?(e=s,t=0,o=-1):e=te(e,s);let i=e.length,r=0;for(;t<i;){a&&(e[t]===10&&(r=++t),a=!1);let c=-1;for(;t<i&&c===-1;++t)switch(e[t]){case 58:o===-1&&(o=t-r);break;case 13:a=!0;case 10:c=t;break}if(c===-1)break;n(e.subarray(r,c),o),r=t,o=-1}r===i?e=void 0:r!==0&&(e=e.subarray(r),t-=r)}}function Y(n,e,t){let o=N(),a;return a={decode(l){return decodeURIComponent(escape(String.fromCharCode(...l)))}},a=new TextDecoder,function(s,i){if(s.length===0)t==null||t(o),o=N();else if(i>0){let r=a.decode(s.subarray(0,i)),c=i+(s[i+1]===32?2:1),u=a.decode(s.subarray(c));switch(r){case"data":o.data=o.data?o.data+`
`+u:u;break;case"event":o.event=u;break;case"id":n(o.id=u);break;case"retry":let w=parseInt(u,10);isNaN(w)||e(o.retry=w);break;default:let O=a.decode(s,{stream:!0});o.data=O,t(o);break}}}}function te(n,e){let t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function N(){return{data:"",event:"",id:"",retry:void 0}}var re=function(n,e){var t={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(t[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,o=Object.getOwnPropertySymbols(n);a<o.length;a++)e.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(n,o[a])&&(t[o[a]]=n[o[a]]);return t},S="text/event-stream",J="last-event-id",ae=3e5,ie=12e4,se=5;function _(n,e,t){var{signal:o,headers:a,onopen:l,onmessage:s,onclose:i,onerror:r,openWhenHidden:c,fetch:u,timeout:w=ae,heartbeatTimeout:O=ie}=e,W=re(e,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch","timeout","heartbeatTimeout"]);let{maxRetryCount:C=se}=t;return new Promise((L,A)=>{let p=Object.assign({},a);p.accept||(p.accept=S);let f,h=0,b=null,V=Date.now();function $(){f.abort(),document.hidden||T()}c||document.addEventListener("visibilitychange",$);let k=1e3,y=0;function g(){document.removeEventListener("visibilitychange",$),window.clearTimeout(y),R(),f.abort()}function R(){b&&(window.clearTimeout(b),b=null)}function I(){R(),V=Date.now(),b=window.setTimeout(()=>{console.warn("\u{1F494} SSE\u5FC3\u8DF3\u8D85\u65F6\uFF0C\u4E3B\u52A8\u65AD\u5F00\u8FDE\u63A5\u91CD\u8FDE"),f.abort(),y=window.setTimeout(T,2e3)},O)}o==null||o.addEventListener("abort",()=>{g(),L()});let K=u!=null?u:window.fetch,q=l!=null?l:ce;function T(){return E(this,null,function*(){var x;f=new AbortController;let M=window.setTimeout(()=>{console.warn("\u23F0 SSE\u8BF7\u6C42\u8D85\u65F6\uFF0C\u4E3B\u52A8\u65AD\u5F00\u8FDE\u63A5"),f.abort()},w);try{console.log(`\u{1F504} \u5F00\u59CBSSE\u8FDE\u63A5\uFF0C\u91CD\u8BD5\u6B21\u6570: ${h}/${C}`);let m=yield K(n,Object.assign(Object.assign({},W),{headers:p,signal:f.signal}));window.clearTimeout(M),yield q(m),h=0,I(),yield P(m.body,B(Y(d=>{I(),d?p[J]=d:delete p[J]},d=>{k=d},d=>{I(),s&&s(d)}))),i==null||i(),g(),L()}catch(m){if(window.clearTimeout(M),R(),f.signal.aborted)console.log("\u{1F6D1} SSE\u8FDE\u63A5\u88AB\u4E3B\u52A8\u4E2D\u6B62");else{console.error(`\u274C SSE\u8FDE\u63A5\u9519\u8BEF (\u7B2C${h+1}\u6B21):`,m);try{if(h<C){h++;let d=k*Math.pow(1.5,h-1),U=(x=r==null?void 0:r(m))!==null&&x!==void 0?x:d;console.log(`\u{1F504} \u5C06\u5728 ${U}ms \u540E\u8FDB\u884C\u7B2C${h}\u6B21\u91CD\u8BD5`),window.clearTimeout(y),y=window.setTimeout(T,U)}else console.error("\u274C \u8FBE\u5230\u6700\u5927\u91CD\u8BD5\u6B21\u6570\uFF0C\u505C\u6B62\u91CD\u8BD5"),g(),A(new Error(`SSE\u8FDE\u63A5\u5931\u8D25\uFF0C\u5DF2\u91CD\u8BD5${C}\u6B21: ${m.message}`))}catch(d){console.error("\u274C \u9519\u8BEF\u5904\u7406\u8FC7\u7A0B\u4E2D\u53D1\u751F\u5F02\u5E38:",d),g(),A(d)}}}})}T()})}function ce(n){let e=n.headers.get("content-type");if(!(e!=null&&e.startsWith(S)))throw new Error(`Expected content-type to be ${S}, Actual: ${e}`)}var le={data(){return{ctrl:null}},methods:{objToJson(n){let e={};for(let t in n){let o=n[t];typeof o=="string"||typeof o=="number"||typeof o=="boolean"?e[t]=o:e[t]=o.toString()}return e},stopChatCore(){var n;(n=this.ctrl)==null||n.abort()},startChatCore(n){let{url:e,body:t,headers:o,method:a,timeout:l,heartbeatTimeout:s,maxRetryCount:i}=n;if(e){console.log(n);try{this.ctrl=new AbortController,_(e,{readJson:!0,method:a,openWhenHidden:!0,signal:this.ctrl.signal,timeout:l||3e5,heartbeatTimeout:s||12e4,headers:H({"Content-Type":"application/json"},o),body:t||void 0,onopen:r=>{this.$ownerInstance.callMethod("open",this.objToJson(r))},onmessage:r=>{this.$ownerInstance.callMethod("message",r)},onerror:r=>(console.error("\u274C SSE\u8FDE\u63A5\u9519\u8BEF:",r),this.$ownerInstance.callMethod("error",JSON.stringify(r)),3e3)},{maxRetryCount:i}).then(()=>{this.$ownerInstance.callMethod("finish")}).catch(r=>{console.error("\u{1F4A5} SSE\u8FDE\u63A5\u5F02\u5E38:",r),this.$ownerInstance.callMethod("error",r)})}catch(r){console.error("\u{1F6A8} \u542F\u52A8SSE\u8FDE\u63A5\u65F6\u51FA\u73B0\u5F02\u5E38:",r)}}}}};return ee(de);})();
